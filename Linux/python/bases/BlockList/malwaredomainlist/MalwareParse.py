import requests
import os
from datetime import datetime

def main(url):
    name = datetime.now().strftime("%Y-%m-%d_%H_%M") + '.csv'
    file = open(name, 'w')
    try:
        req = requests.get(url)
        lines = req.text.split('\n')
        for line in lines:
            row = line.split(',')
            if(len(row) > 8):
                date = row[0][1:-1]
                domain = row[1][1:-1]
                ip = row[2][1:-1]
                reverse = row[3][1:-1]
                description = row[4][1:-1]
                registrant = row[5][1:-1]
                asn = row[6][1:-1]
                inactive = row[7][1:-1]
                country = row[8][1:-1]
                file.write(date +', '+ 
                           domain +', '+ 
                           ip +', '+ 
                           reverse +', '+ 
                           description +', '+ 
                           registrant +', '+ 
                           asn +', '+ 
                           inactive +', '+ 
                           country + '\n')
    except:
        pass
    file.close()

if(__name__ == '__main__'):
    url = 'http://www.malwaredomainlist.com/mdlcsv.php'
    main(url)